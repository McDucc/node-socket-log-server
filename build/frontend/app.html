<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/style.css">

    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="/translation.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/frontend.js"></script>
</head>

<body x-data class="body-base">
    <div class="modal-overlay" x-show="$store.controls.showModal"></div>
    <div class="modalx bd-example" x-show="$store.controls.showModal">

        <p class="mt-2" x-text="translate('password')"></p>
        <input class="form-control" type="text" x-model="$store.credentials.password"
            @keydown.enter="$store.controls.showModal = false; authenticate();">
        <div class=" mt-4">
            <button class="btn btn-primary" @click=" $store.controls.showModal=false; authenticate();"
                x-text="translate('close')"></button>
        </div>
    </div>
    <div class="col-md-11 mt-3 m-auto">
        <a class="title-x blue-text">WS</a>
        <a class="title-x">Logger</a>


        <!-- Controls header -->
        <div class="bd-example row col-md-12 mt-4 m-auto">
            <div class="row mt-2">
                <div class="col-md-12">
                    <button class="alert btn btn-primary float-start" x-on:click="$store.controls.showModal = true;"
                        x-text="translate('authenticate')">
                    </button>

                    <button class="alert btn btn-primary float-end"
                        x-on:click="$store.controls.showServerMetrics ^= true"
                        x-text="$store.controls.showServerMetrics ? 'Switch to messages' : 'Switch to metrics'">
                    </button>
                    <div class="alert alert-danger ms-4 float-start" x-show="$store.credentials.authenticated == 1"
                        x-text="translate('credentials_incorrect')">
                    </div>
                    <div class="alert alert-dark ms-4 alm float-start" x-show="$store.credentials.authenticated == 2"
                        x-text="translate('auth_successful')">
                    </div>
                </div>
            </div>
            <div class=" row mt-2">

                <!--Search Term-->
                <div class="col-md-3">
                    <p x-text="translate('search_term')"></p>
                    <input class="form-control" type="text" x-model="$store.controls.searchTerm">
                    <button class="btn btn-primary form-control mt-2" x-bind:disabled="!!$store.controls.autoUpdate"
                        x-text="translate('search')"></button>
                </div>

                <!--Timeframe-->
                <div class="col-md-3">
                    <p x-text="translate('timeframe_type')"></p>
                    <select x-model="$store.controls.timeframeType" class="form-control mt-2">
                        <option value="since" selected x-text="translate('timeframe_type_since')"></option>
                        <option value="timeframe" x-text="translate('timeframe_type_timeframe')"></option>
                    </select>
                    <div x-show="$store.controls.timeframeType == 'since'">
                        <select class="form-control mt-2" x-model="$store.controls.timeSelect">
                            <template x-for="val in [5,10,15,30,60]">
                                <option x-text="val + translate('minutes')" :value="val*1000"></option>
                            </template>
                            <template x-for="val in [2,4,8,24,48]">
                                <option x-text="val + translate('hours')" :value="val*60*60*1000"></option>
                            </template>
                            <option x-text="translate('all_time')" :value="2000000000000"></option>
                        </select>
                    </div>
                    <div x-show="$store.controls.timeframeType == 'timeframe'">
                        <input class="form-control mt-1" type="datetime-local" x-model="$store.controls.datetime1">
                        <input class="form-control mt-1" type="datetime-local" x-model="$store.controls.datetime2">
                    </div>
                </div>

                <!--Update speed-->
                <div class="col-md-2">
                    <p x-text="translate('update_speed')"></p>
                    <select class="form-control mt-2" x-model="$store.controls.autoUpdateSpeed">
                        <template x-for="val in [3,5,10,15,30,60]">
                            <option x-text="val + translate('seconds')" :value="val*1000"></option>
                        </template>
                    </select>
                    <button class="btn btn-primary form-control mt-2" x-on:click="$store.controls.autoUpdate ^= true"
                        x-text="$store.controls.autoUpdate ? translate('auto_update_active') : translate('auto_update_deactivated')"></button>
                </div>

                <!--Channel filer-->
                <div class="col-md-2">
                    <p x-text="translate('filter_by_channel')"></p>
                    <select class="form-control mt-2" x-model="$store.controls.channelFilter" multiple>
                        <template x-for="channel in $store.log.channels">
                            <option x-bind:value="channel" x-text="channel"></option>
                        </template>
                    </select>
                </div>


                <!--Server filter-->
                <div class="col-md-2">
                    <p x-text="translate('filter_by_server')"></p>
                    <select class="form-control mt-2" x-model="$store.controls.serverFilter" multiple>
                        <template x-for="server in $store.log.servers">
                            <option x-bind:value="server" x-text="server"></option>
                        </template>
                    </select>
                </div>
            </div>
        </div>

        <!-- Metrics Page -->
        <div class="bd-example row col-md-12 mt-4 alx-messages" x-show="$store.controls.showServerMetrics">
            <template x-for="server in $store.log.servers">
                <div class="bd-example col-md-12 mt-2">
                    <div x-text="server.name" class="text-center"></div>
                    <template x-for="metric in $store.controls.metrics">
                        <div class="col-md-3 float-start p-5">
                            <canvas class="metric-canvas" :id="server.name + ': ' + metric"></canvas>
                        </div>
                    </template>
                </div>
            </template>
        </div>

        <!-- Logs Page -->
        <div class="bd-example row col-md-12 mt-4 alx-messages" x-show="!$store.controls.showServerMetrics">
            <template x-for="i in $store.controls.lastPage">
                <div :class="i-1 == $store.controls.page ? 'btn btn-primary alx-selected' : 'btn btn-primary alx'"
                    x-text="i" @click="$store.controls.page = i-1">
                </div>
            </template>
            <template x-for="message in $store.log.messages">
                <div class="alert alert-dark alm">
                    <b x-text="translate('time')"></b> <span
                        x-text="new Date(parseInt(message.time)).toISOString().replaceAll('T',' ').replaceAll('Z',' ')"></span><br>
                    <b x-text="translate('message')"></b> <span x-text="message.message"></span><br>
                    <b x-text="translate('level')"></b> <span x-text="message.level"></span><br>
                    <b x-text="translate('server')"></b> <span x-text="message.server"></span><br>
                    <b x-text="translate('data')"></b> <span x-html="prettifyJson(message.data)"></span><br>
                </div>
            </template>
        </div>
    </div>
</body>

</html>